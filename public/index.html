<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Host a Hack!</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        min-height: 100vh;
      }

      body {
        display: flex;
        justify-content: center;
        font-family: Inter;
        align-items: flex-start;
      }

      div.main-container {
        padding-top: 7vh;
        display: grid;
        grid-template-columns: minmax(max-content, 1fr) 600px;
        row-gap: 5vh;
        column-gap: 25px;
        background: linear-gradient(
          to right,
          transparent 0%,
          white 20%,
          white 80%,
          transparent 100%
        );
      }

      div.intro {
        grid-column-start: 2;
        grid-row-start: 1;
      }

      p,
      h1 {
        margin: 0;
      }

      .gradtext {
        background: linear-gradient(90deg, #ff512f 0%, #dd2476 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      h1.title {
        font-size: 32px;
        font-weight: 800;

        padding: 2rem 0;
        display: inline-block;
      }

      p.description {
        color: #555;
        font-size: 21px;
        font-weight: 500;
        line-height: 33px;
      }

      div.number {
        font-size: 32px;
        font-weight: 800;
        grid-column-start: 1;
        text-align: right;
        justify-self: end;
      }

      div.num-1 {
        grid-row-start: 2;
      }

      div.num-2 {
        grid-row-start: 3;
      }

      div.num-3 {
        grid-row-start: 4;
        display: flex;
        align-items: flex-end;
        flex-direction: column;
      }

      div.num-3 .optional {
        font-size: 16px;
      }

      div.step-1 {
        grid-column-start: 2;
        grid-row-start: 2;
      }
      div.step-2 {
        grid-column-start: 2;
        grid-row-start: 3;
      }

      div.terminal {
        width: 100%;
        background-color: #2b2b2b;
        overflow: hidden;
        border-radius: 4px;
        display: flex;
        flex-direction: column;
      }

      div.terminal .row {
        display: flex;
        padding: 17px 20px 12px;
        gap: 9px;
      }

      div.terminal .row .circle {
        border-radius: 50%;
        width: 12px;
        height: 12px;
      }

      div.terminal .row .circle.red {
        background-color: #ff5f59;
      }

      div.terminal .row .circle.yellow {
        background-color: #ffbc2d;
      }

      div.terminal .row .circle.green {
        background-color: #27c940;
      }

      div.terminal iframe {
        width: 100%;
        margin-left: 14px;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="intro">
        <h1 class="title gradtext">Host a Hack</h1>
        <p class="description">
          Finished your hack and want to host it? Use our service to stage your
          hack and learn to deploy it to production.
        </p>
      </div>
      <div class="number num-1 gradtext">1</div>
      <div class="number num-2 gradtext">2</div>
      <div class="number num-3">
        <div class="gradtext">3</div>
        <div class="optional gradtext">(Optional)</div>
      </div>
      <div class="step-1">
        <form id="zip-form">
          <input id="zip-upload" type="file" webkitdirectory mozdirectory />
          <button type="submit">Upload folder</button>
        </form>
        <p id="statusMessage"></p>
      </div>
      <div class="step-2">
        <div class="terminal">
          <div class="row">
            <div class="circle red"></div>
            <div class="circle yellow"></div>
            <div class="circle green"></div>
          </div>
          <iframe src="/api/ttyd" frameborder="0"></iframe>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@zip.js/zip.js@2.7.20/dist/zip.min.js"></script>
    <script>
      folder = document.getElementById("zip-upload");
      let blobWriter;
      folder.addEventListener("change", async (e) => {
        blobWriter = new zip.BlobWriter("application/zip");
        const zipWriter = new zip.ZipWriter(blobWriter, {
          bufferedWrite: true,
          useCompressionStream: false,
        });
        let files = e.target.files;
        if (files.length > 0) {
          console.log(files);
          await Promise.all(
            Array.from(files).map((file) =>
              zipWriter.add(file.webkitRelativePath, new zip.BlobReader(file))
            )
          );
        } else {
          document.getElementById("statusMessage").innerText =
            "No files selected";
        }
        await zipWriter.close();
      });
      document.getElementById("zip-form").addEventListener("submit", (e) => {
        e.preventDefault();
        blobWriter
          .getData()
          .then((blob) => {
            const formData = new FormData();
            formData.append("folder", blob, "upload.zip");

            fetch("/api/folder", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json())
              .then((data) => {
                document.getElementById("statusMessage").innerText =
                  data.message;
              })
              .catch((error) => {
                document.getElementById("statusMessage").innerText =
                  "Error uploading folder.";
              });
          })
          .catch((error) => {
            document.getElementById("statusMessage").innerText =
              "Error zipping folder.";
          });
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.birds.min.js"></script>
    <script>
      VANTA.BIRDS({
        el: "body",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.0,
        minWidth: 200.0,
        scale: 1.0,
        scaleMobile: 1.0,
        backgroundColor: 0xffffff,
        color1: 0xff512f,
        color2: 0xdd2476,
        quantity: 3.0,
      });
    </script>
  </body>
</html>
